-- ========== Utility / Loader ==========
local ORION_URL = "https://raw.githubusercontent.com/shlexware/Orion/main/source"
local function detect_http_get()
    if pcall(function() return game.HttpGet end) and type(game.HttpGet)=="function" then
        return function(url) return game:HttpGet(url,true) end
    end
    if type(syn)=="table" and type(syn.request)=="function" then
        return function(url) local ok,r=pcall(function() return syn.request({Url=url,Method="GET"}) end) if ok and r then return r.Body end end
    end
    local http = http
    if type(http)=="table" and type(http.request)=="function" then
        return function(url) local ok,r=pcall(function() return http.request({Url=url,Method="GET"}) end) if ok and r then return r.Body end end
    end
    local HttpService = game:GetService("HttpService")
    if HttpService and type(HttpService.GetAsync)=="function" then
        return function(url) local ok,res=pcall(function() return HttpService:GetAsync(url) end) if ok then return res end end
    end
    return nil
end
local http_get = detect_http_get()
local loader = loadstring or (syn and syn.loadstring) or (KRNL and KRNL.loadstring) or (Fluxus and Fluxus.loadstring)

local OrionLib = nil
if loader and http_get then
    pcall(function()
        local src = http_get(ORION_URL)
        if type(src)=="string" and #src>50 then
            local chunk = loader(src)
            if type(chunk)=="function" then
                local ok, lib = pcall(chunk)
                if ok and type(lib)=="table" then OrionLib = lib end
            end
        end
    end)
end

if not OrionLib then return warn("Failed to load Orion Library") end

-- ========== Main GUI ==========
local Window = OrionLib:MakeWindow({
    Name = "Universal Roblox GUI",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "UniversalOrion"
})

-- ========== Tabs ==========
local PlayerTab = Window:MakeTab({
    Name = "Player",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local MiscTab = Window:MakeTab({
    Name = "Misc",
    Icon = "rbxassetid://6026568192",
    PremiumOnly = false
})

local ESPTab = Window:MakeTab({
    Name = "ESP",
    Icon = "rbxassetid://6031094678",
    PremiumOnly = false
})

-- ========== Player Tab Features ==========
PlayerTab:AddSlider({
    Name = "WalkSpeed",
    Min = 16,
    Max = 500,
    Default = 16,
    Color = Color3.fromRGB(0,170,255),
    Increment = 1,
    ValueName = "speed",
    Callback = function(value)
        if game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("Humanoid") then
            game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = value
        end
    end
})

PlayerTab:AddSlider({
    Name = "JumpPower",
    Min = 50,
    Max = 500,
    Default = 50,
    Color = Color3.fromRGB(255,170,0),
    Increment = 1,
    ValueName = "jump",
    Callback = function(value)
        if game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("Humanoid") then
            game.Players.LocalPlayer.Character.Humanoid.JumpPower = value
        end
    end
})

PlayerTab:AddButton({
    Name = "Reset Player Stats",
    Callback = function()
        local player = game.Players.LocalPlayer
        if player.Character and player.Character:FindFirstChild("Humanoid") then
            player.Character.Humanoid.WalkSpeed = 16
            player.Character.Humanoid.JumpPower = 50
            OrionLib:MakeNotification({
                Name = "Player Reset",
                Content = "WalkSpeed and JumpPower reset to default!",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
        end
    end
})

-- ========== Misc Tab Features ==========
MiscTab:AddToggle({
    Name = "Infinite Jump",
    Default = false,
    Callback = function(state)
        local player = game.Players.LocalPlayer
        local mouse = player:GetMouse()
        local connection
        if state then
            connection = mouse.KeyDown:Connect(function(key)
                if key == " " then
                    local char = player.Character
                    if char and char:FindFirstChild("Humanoid") then
                        char.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                end
            end)
            MiscTab:AddButton({Name="Disable Infinite Jump", Callback=function() connection:Disconnect() end})
        end
    end
})

MiscTab:AddButton({
    Name = "Server Hop",
    Callback = function()
        local HttpService = game:GetService("HttpService")
        local TeleportService = game:GetService("TeleportService")
        local PlaceID = game.PlaceId
        local servers = {}
        local success, response = pcall(function()
            return game:HttpGet("https://games.roblox.com/v1/games/"..PlaceID.."/servers/Public?sortOrder=Asc&limit=100")
        end)
        if success and response then
            local data = HttpService:JSONDecode(response)
            for i,v in pairs(data.data) do
                if v.playing < v.maxPlayers then
                    table.insert(servers,v.id)
                end
            end
            if #servers > 0 then
                local server = servers[math.random(1,#servers)]
                TeleportService:TeleportToPlaceInstance(PlaceID, server)
            end
        end
    end
})

-- ========== ESP Tab Features ==========
local ESP = {}
ESPTab:AddToggle({
    Name = "Player ESP",
    Default = false,
    Callback = function(state)
        if state then
            for i,v in pairs(game:GetService("Players"):GetPlayers()) do
                if v ~= game.Players.LocalPlayer then
                    local box = Instance.new("BoxHandleAdornment")
                    box.Adornee = v.Character and v.Character:FindFirstChild("HumanoidRootPart") or nil
                    box.Size = Vector3.new(4,6,2)
                    box.Color3 = Color3.new(1,0,0)
                    box.AlwaysOnTop = true
                    box.ZIndex = 10
                    box.Parent = game:GetService("CoreGui")
                    ESP[v.Name] = box
                end
            end
        else
            for i,v in pairs(ESP) do
                v:Destroy()
            end
            ESP = {}
        end
    end
})

-- ========== Notify Loaded ==========
OrionLib:MakeNotification({
    Name = "Loaded",
    Content = "Universal Roblox GUI Loaded Successfully!",
    Image = "rbxassetid://4483345998",
    Time = 5
})
